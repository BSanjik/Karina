<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>13x11 Heart + Character ‚ù§Ô∏è</title>
  <style>
    :root { 
      --cell: 22px;
      --character-size: 160px;
    }
    body {
      margin: 0;
      width: 100vw;
      height: 100vh;
      font-family: system-ui, -apple-system, "Inter", sans-serif;
      overflow: hidden;
    }

    .main-content {
      width: 100vh;
      height: 100vw;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      background: radial-gradient(circle at center, #ffe4ec, #fff);
      transform: rotate(90deg);
      transform-origin: center center;
      position: fixed;
      top: 50%;
      left: 50%;
      margin-top: -50vw;
      margin-left: -50vh;
    }

    .main-content.show {
      display: flex;
    }

    .wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    .character-drawing {
      width: var(--character-size);
      height: var(--character-size);
      position: absolute;
      bottom: 15px;
      left: 30px;
    }

    .character-drawing img {
      width: var(--character-size);
      height: var(--character-size);
      object-fit: cover;
      object-position: center;
    }
    
    .character-drawing img.static-image {
      object-fit: contain !important;
      width: var(--character-size) !important;
      height: var(--character-size) !important;
      max-width: var(--character-size);
      max-height: var(--character-size);
    }
    

    .container {
      display: grid;
      grid-template-columns: repeat(13, var(--cell));
      grid-auto-rows: var(--cell);
      gap: 3px;
      place-items: center;
      transition: transform 0.4s ease;
    }

    .container.pulse {
      animation: heartbeat 1.6s ease-in-out infinite;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.05); }
      50% { transform: scale(0.97); }
      75% { transform: scale(1.03); }
    }

    .heart {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: calc(var(--cell) * 0.9);
      opacity: 0;
      transform: scale(0.3);
      transition: transform 150ms ease, opacity 150ms ease;
      background: linear-gradient(135deg, #f472b6, #ef4444);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 6px rgba(236, 72, 153, 0.35));
    }
    .heart::before { content: "‚ù§Ô∏è"; }
    .heart.show { opacity: 1; transform: scale(1); }

    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, #fff, rgba(255,255,255,0));
      border-radius: 50%;
      pointer-events: none;
      opacity: 0;
      animation: sparkleAnim 0.8s ease-out forwards;
    }

    @keyframes sparkleAnim {
      0% { opacity: 1; transform: scale(0.5); }
      100% { opacity: 0; transform: scale(1.8) translateY(-20px); }
    }

    .final-text {
      font-size: clamp(20px, 4vw, 34px);
      color: #ec4899;
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 500ms ease, transform 500ms ease;
      text-align: center;
      width: 100%;
      position: relative;
      z-index: 10;
    }
    .final-text.show {
      opacity: 1;
      transform: translateY(0);
    }

    button {
      border: none;
      background: linear-gradient(135deg, #f472b6, #ec4899);
      color: #fff;
      font-weight: 600;
      padding: 10px 16px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(236,72,153,.3);
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 500ms ease, transform 500ms ease;
    }
    
    button.show {
      opacity: 1;
      transform: translateY(0);
    }


    .countdown-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 999;
      color: white;
      font-size: 32px;
      text-align: center;
    }

    .countdown-number {
      font-size: 80px;
      font-weight: bold;
      margin: 20px 0;
      animation: pulse 1s ease-in-out;
    }


    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è iPhone 13 –∏ –ø–æ—Ö–æ–∂–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    @media screen and (max-width: 430px) and (max-height: 932px) {
      :root {
        --cell: 18px;
        --character-size: 130px;
      }
      
      .main-content {
        gap: 15px;
      }
      
      .character-drawing {
        bottom: 10px;
        left: 20px;
      }
      
      .final-text {
        font-size: clamp(16px, 3vw, 24px);
      }
      
      button {
        padding: 8px 14px;
        font-size: 14px;
      }
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media screen and (max-width: 375px) {
      :root {
        --cell: 16px;
        --character-size: 110px;
      }
      
      .character-drawing {
        bottom: 8px;
        left: 15px;
      }
    }
  </style>
</head>
<body>

  <div class="countdown-screen" id="countdownScreen">
    <div style="font-size: 20px; margin-bottom: 15px;">üì± –ü–æ–≤–µ—Ä–Ω–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–∞–ª–µ–≤–æ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>
    <div>–ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞—á–Ω–µ—Ç—Å—è —á–µ—Ä–µ–∑</div>
    <div class="countdown-number" id="countdownNumber">10</div>
    <div style="font-size: 18px; opacity: 0.7;">–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Å—è! ‚ù§Ô∏è</div>
  </div>

  <div class="main-content">
    <div class="character-drawing">
      <img src="mlqcxbiu.gif" alt="Cute character" />
    </div>

    <div class="wrapper">
      <div id="heartContainer" class="container"></div>
      <div id="finalText" class="final-text">–Ø —Ç–µ–±—è –æ–±–æ–∂–∞—é –º–æ—è –º–∞–ª–µ–Ω—å–∫–∞—è –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞ ‚ù§Ô∏è</div>
      <button id="replayBtn">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
    </div>
  </div>

  <script>
    const pattern = [
      [0,0,1,1,1,0,0,0,1,1,1,0,0],
      [0,1,1,1,1,1,0,1,1,1,1,1,0],
      [1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1],
      [0,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,0,1,1,1,1,1,1,1,1,1,0,0],
      [0,0,0,1,1,1,1,1,1,1,0,0,0],
      [0,0,0,0,1,1,1,1,1,0,0,0,0],
      [0,0,0,0,0,1,1,1,0,0,0,0,0],
      [0,0,0,0,0,0,1,0,0,0,0,0,0],
    ];

    const container = document.getElementById('heartContainer');
    const finalText = document.getElementById('finalText');
    const replayBtn = document.getElementById('replayBtn');

    function createSparkle() {
      const sparkle = document.createElement('div');
      sparkle.classList.add('sparkle');
      sparkle.style.left = `${Math.random() * 100}%`;
      sparkle.style.top = `${Math.random() * 100}%`;
      document.body.appendChild(sparkle);
      setTimeout(() => sparkle.remove(), 800);
    }

    function buildGrid() {
      // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
      container.innerHTML = '';
      finalText.classList.remove('show');
      replayBtn.classList.remove('show');
      container.classList.remove('pulse');
      
      const hearts = [];
      for (let rowIndex = 0; rowIndex < pattern.length; rowIndex++) {
        const row = pattern[rowIndex];
        for (const cell of row) {
          if (cell === 1) {
            const d = document.createElement('div');
            d.className = 'cell heart';
            d.dataset.row = rowIndex;
            container.appendChild(d);
            hearts.push(d);
          } else {
            const d = document.createElement('div');
            d.className = 'cell empty';
            container.appendChild(d);
          }
        }
      }
      return hearts;
    }

    function animateHearts() {
      const hearts = buildGrid();
      
      // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –µ–≥–æ –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞
      const indices = Array.from({length: hearts.length}, (_, i) => i);
      for (let i = indices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [indices[i], indices[j]] = [indices[j], indices[i]];
      }
      
      let i = 0;
      function tick() {
        if (i < indices.length) {
          const heartIndex = indices[i];
          const el = hearts[heartIndex];
          el.classList.add('show');
          i++;
            // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ—è–≤–ª–µ–Ω–∏—è–º–∏ —Å–µ—Ä–¥–µ—á–µ–∫ (—É—Å–∫–æ—Ä–µ–Ω–æ)
            const randomDelay = 20 + Math.random() * 40;
          setTimeout(tick, randomDelay);
        } else {
          container.classList.add('pulse');
          setTimeout(() => {
            finalText.classList.add('show');
            replayBtn.classList.add('show');
          }, 500);
          let sparks = 0;
          const sparkleInterval = setInterval(() => {
            createSparkle();
            sparks++;
            if (sparks > 12) clearInterval(sparkleInterval);
          }, 150);
        }
      }
      tick();
    }

    let isFirstTime = true;

    function replaceGifWithStatic() {
      const characterImg = document.querySelector('.character-drawing img');
      characterImg.src = 'asd.gif';
      characterImg.classList.add('static-image');
    }

    function restartCharacterGif() {
      const characterImg = document.querySelector('.character-drawing img');
      characterImg.classList.remove('static-image');
      characterImg.src = 'mlqcxbiu.gif?' + new Date().getTime(); // –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
      
      // –ß–µ—Ä–µ–∑ 10.3 —Å–µ–∫—É–Ω–¥—ã —Å–Ω–æ–≤–∞ –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω—É—é
      setTimeout(() => {
        replaceGifWithStatic();
      }, 10300);
    }

    function initialAnimation() {
      buildGrid(); // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É —Å–µ—Ä–¥–µ—Ü, –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö
      
      if (isFirstTime) {
        // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (10.3 —Å–µ–∫—É–Ω–¥—ã)
        setTimeout(() => {
          // –ó–∞–º–µ–Ω—è–µ–º GIF –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É
          replaceGifWithStatic();
          // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å–µ—Ä–¥—Ü–∞
          animateHearts();
          isFirstTime = false;
        }, 10300);
      } else {
        // –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ - —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–¥—Ü–∞
        animateHearts();
      }
    }

    // –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º GIF –∏ –∞–Ω–∏–º–∞—Ü–∏—é —Å–µ—Ä–¥—Ü–∞
    replayBtn.addEventListener('click', () => {
      if (isFirstTime) {
        initialAnimation();
      } else {
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        container.innerHTML = '';
        container.classList.remove('pulse');
        finalText.classList.remove('show');
        replayBtn.classList.remove('show');
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Ç–∫—É
        buildGrid();
        
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º GIF –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        restartCharacterGif();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å–µ—Ä–¥—Ü–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 10.3 —Å–µ–∫
        setTimeout(() => {
          animateHearts();
        }, 10300);
      }
    });
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
    function startCountdown() {
      const countdownScreen = document.getElementById('countdownScreen');
      const countdownNumber = document.getElementById('countdownNumber');
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
      countdownScreen.style.display = 'flex';
      
      let count = 10;
      countdownNumber.textContent = count;
      
      const countdownInterval = setInterval(() => {
        count--;
        if (count > 0) {
          countdownNumber.textContent = count;
          // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏
          countdownNumber.style.animation = 'none';
          countdownNumber.offsetHeight; // trigger reflow
          countdownNumber.style.animation = 'pulse 1s ease-in-out';
        } else {
          clearInterval(countdownInterval);
          // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
          countdownScreen.style.display = 'none';
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
          document.querySelector('.main-content').classList.add('show');
          // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
          initialAnimation();
        }
      }, 1000);
    }

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    window.addEventListener('DOMContentLoaded', startCountdown);
  </script>
</body>
</html>